<ion-header [translucent]="true">
  <ion-toolbar color="fav">
    <ion-title>{{ title }}</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="dismiss()">
        <ion-icon name="close" slot="icon-only"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-segment *ngIf="add_id === 3" (ionChange)="segmentChanged($event)">
  <ion-segment-button value="first" content-id="first">
    <ion-label>Single Budget</ion-label>
  </ion-segment-button>
  <ion-segment-button value="second" content-id="second">
    <ion-label>Auto Split</ion-label>
  </ion-segment-button>
</ion-segment>

<ion-content class="ion-padding">
  <!-- Add Account Form -->
  <ng-container *ngIf="add_id === 1">
    <ion-row>
      <ion-col>
        <ion-item>
          <ion-icon
            name="person-circle-outline"
            slot="start"
            color="secondary"
          ></ion-icon>
          <ion-input
            type="text"
            placeholder="Enter the account name"
            label="Account Name"
            labelPlacement="stacked"
            [(ngModel)]="params.account_name"
          ></ion-input>
        </ion-item>
      </ion-col>
    </ion-row>

    <ion-row>
      <ion-col>
        <ion-item>
          <ion-icon
            name="list-circle-outline"
            slot="start"
            color="secondary"
          ></ion-icon>
          <ion-select
            label="Type"
            label-placement="stacked"
            [(ngModel)]="params.account_type"
          >
            <ion-select-option value="">Select Type</ion-select-option>
            <ion-select-option *ngFor="let type of types" [value]="type.type">
              {{ type.type }}
            </ion-select-option>
          </ion-select>
        </ion-item>
      </ion-col>
    </ion-row>

    <ion-row>
      <ion-col>
        <ion-item>
          <ion-icon
            name="cash-outline"
            slot="start"
            color="secondary"
          ></ion-icon>
          <ion-input
            type="number"
            placeholder="Initial Balance"
            label="Initial Balance"
            labelPlacement="stacked"
            [(ngModel)]="params.balance"
          >
            <ion-label slot="start">MYR</ion-label>
          </ion-input>
        </ion-item>
      </ion-col>
    </ion-row>
  </ng-container>

  <!-- Add Expense Form -->
  <ng-container *ngIf="add_id === 2">
    <ion-row>
      <ion-col>
        <ion-item>
          <ion-icon
            name="cash-outline"
            slot="start"
            color="secondary"
          ></ion-icon>
          <ion-input
            type="number"
            placeholder="Enter expense amount"
            label="Amount"
            labelPlacement="stacked"
            [(ngModel)]="params.transaction_amount"
          >
          </ion-input>
          <ion-note slot="end" color="medium">MYR</ion-note>
        </ion-item>
      </ion-col>
    </ion-row>

    <ion-row>
      <ion-col>
        <ion-item>
          <ion-icon
            name="swap-horizontal-outline"
            slot="start"
            color="secondary"
          ></ion-icon>
          <ion-select
            label="Type"
            label-placement="stacked"
            [(ngModel)]="params.transaction_type"
            interface="popover"
            (ionChange)="getCategory($event)"
          >
            <ion-select-option value="income">Income</ion-select-option>
            <ion-select-option value="expense">Expense</ion-select-option>
          </ion-select>
        </ion-item>
      </ion-col>
    </ion-row>

    <ion-row>
      <ion-col>
        <ion-item>
          <ion-icon
            name="pricetags-outline"
            slot="start"
            color="secondary"
          ></ion-icon>
          <ion-label position="stacked">
            Category {{ label ? "(" + label + ")" : "" }}
          </ion-label>
          <ion-select
            [(ngModel)]="params.transaction_category"
            [disabled]="disabled"
            label-placement="stacked"
          >
            <ion-select-option value="">Select Category</ion-select-option>
            <ion-select-option
              *ngFor="let category of categories"
              [value]="category.name"
            >
              {{ category.name | titlecase }}
            </ion-select-option>
          </ion-select>
        </ion-item>
      </ion-col>
    </ion-row>

    <ion-row>
      <ion-col>
        <ion-item>
          <ion-icon
            name="wallet-outline"
            slot="start"
            color="secondary"
          ></ion-icon>
          <ion-select
            label="From Account"
            label-placement="stacked"
            [(ngModel)]="params.accounts"
          >
            <ion-select-option value="">Select Account</ion-select-option>
            <ion-select-option *ngFor="let acc of accountUser" [value]="acc.id">
              {{ acc.account_name | titlecase }}
            </ion-select-option>
          </ion-select>
        </ion-item>
      </ion-col>
    </ion-row>

    <ion-row>
      <ion-col>
        <ion-item>
          <ion-icon
            name="document-text-outline"
            slot="start"
            color="secondary"
          ></ion-icon>
          <ion-textarea
            class="ion-no-padding"
            label="Description"
            labelPlacement="stacked"
            [(ngModel)]="params.transaction_description"
          >
          </ion-textarea>
        </ion-item>
      </ion-col>
    </ion-row>

    <ion-row>
      <ion-col>
        <ion-item>
          <ion-icon
            name="calendar-outline"
            slot="start"
            color="secondary"
          ></ion-icon>
          <ion-input
            label="Date"
            id="open-date-popover"
            labelPlacement="stacked"
            [value]="params.transaction_date | date : 'dd/MM/yyyy'"
            readonly
          >
          </ion-input>
        </ion-item>
      </ion-col>
    </ion-row>

    <ion-popover trigger="open-date-popover" showBackdrop="true">
      <ng-template>
        <ion-datetime
          presentation="date"
          (ionChange)="setDate($event)"
          [max]="maxDate"
        ></ion-datetime>
      </ng-template>
    </ion-popover>
  </ng-container>

  <!-- Add budget Form -->
  <ng-container *ngIf="add_id === 3">
    <ion-segment-view>
      <!-- Add budget Form -->
      <ion-segment-content id="first">
        <ion-row>
          <ion-col>
            <ion-item>
              <ion-icon
                name="document-text-outline"
                slot="start"
                color="secondary"
              ></ion-icon>
              <ion-input
                type="text"
                placeholder="e.g. Monthly Budget"
                label="Budget Name"
                labelPlacement="stacked"
                [(ngModel)]="params1.budget_name"
              >
              </ion-input>
            </ion-item>
          </ion-col>
        </ion-row>

        <ion-row>
          <ion-col>
            <ion-item>
              <ion-icon
                name="pricetags-outline"
                slot="start"
                color="secondary"
              ></ion-icon>
              <ion-select
                label="Budget Category"
                label-placement="stacked"
                [(ngModel)]="params1.budget_type"
              >
                <ion-select-option value="">Select Category</ion-select-option>
                <ion-select-option *ngFor="let ex of expense" [value]="ex.name">
                  {{ ex.name | titlecase }}
                </ion-select-option>
              </ion-select>
            </ion-item>
          </ion-col>
        </ion-row>

        <ion-row>
          <ion-col>
            <ion-item>
              <ion-icon
                name="cash-outline"
                slot="start"
                color="secondary"
              ></ion-icon>
              <ion-input
                type="number"
                placeholder="e.g. 1000"
                label="Budget Amount"
                labelPlacement="stacked"
                [(ngModel)]="params1.amount"
              >
              </ion-input>
              <ion-note slot="end" color="medium">MYR</ion-note>
            </ion-item>
          </ion-col>
        </ion-row>
      </ion-segment-content>

      <!-- Split budget Form -->
      <ion-segment-content id="second">
        <!-- Prefix Input -->
        <ion-row>
          <ion-col>
            <ion-item>
              <ion-icon
                name="pricetag-outline"
                slot="start"
                color="secondary"
              ></ion-icon>
              <ion-label position="stacked">Prefix</ion-label>
              <ion-input
                type="text"
                placeholder="e.g. Monthly Budget"
                [(ngModel)]="params2.prefix"
              ></ion-input>
            </ion-item>
          </ion-col>
        </ion-row>

        <!-- Total Budget Input -->
        <ion-row>
          <ion-col>
            <ion-item>
              <ion-icon
                name="cash-outline"
                slot="start"
                color="secondary"
              ></ion-icon>
              <ion-label position="stacked">Total Budget</ion-label>
              <ion-input
                type="number"
                placeholder="e.g. 1000"
                [(ngModel)]="params2.amount"
              ></ion-input>
              <ion-note slot="end" color="medium">MYR</ion-note>
            </ion-item>
          </ion-col>
        </ion-row>

        <!-- Toggle for Customization -->
        <ion-row class="ion-padding-top">
          <ion-col>
            <ion-item lines="none">
              <ion-icon
                name="settings-outline"
                slot="start"
                color="secondary"
              ></ion-icon>
              <ion-label>Customize Percentages?</ion-label>
              <ion-toggle slot="end" (ionChange)="allowChanges()"></ion-toggle>
            </ion-item>
          </ion-col>
        </ion-row>

        <!-- Percentage Inputs -->
        <ion-row>
          <ion-col size="12">
            <ion-item>
              <ion-icon
                name="wallet-outline"
                slot="start"
                color="secondary"
              ></ion-icon>
              <ion-label position="stacked">Needs</ion-label>
              <ion-input
                type="number"
                placeholder="e.g. 50"
                [(ngModel)]="params2.needs_percent"
                [disabled]="percent_disabled"
              ></ion-input>
              <ion-note slot="end" color="medium">%</ion-note>
            </ion-item>
          </ion-col>

          <ion-col size="12">
            <ion-item>
              <ion-icon
                name="cart-outline"
                slot="start"
                color="secondary"
              ></ion-icon>
              <ion-label position="stacked">Wants</ion-label>
              <ion-input
                type="number"
                placeholder="e.g. 30"
                [(ngModel)]="params2.wants_percent"
                [disabled]="percent_disabled"
              ></ion-input>
              <ion-note slot="end" color="medium">%</ion-note>
            </ion-item>
          </ion-col>

          <ion-col size="12">
            <ion-item>
              <ion-icon
                name="trending-up-outline"
                slot="start"
                color="secondary"
              ></ion-icon>
              <ion-label position="stacked">Savings</ion-label>
              <ion-input
                type="number"
                placeholder="e.g. 20"
                [(ngModel)]="params2.savings_percent"
                [disabled]="percent_disabled"
              ></ion-input>
              <ion-note slot="end" color="medium">%</ion-note>
            </ion-item>
          </ion-col>
        </ion-row>

        <!-- Helper Note -->
        <ion-row *ngIf="!percent_disabled" class="ion-padding-top">
          <ion-col>
            <ion-note color="medium">Total should add up to 100%</ion-note>
          </ion-col>
        </ion-row>
      </ion-segment-content>
    </ion-segment-view>
  </ng-container>
</ion-content>

<ion-footer>
  <ion-toolbar style="padding-left: 8px; padding-right: 8px">
    <ion-buttons slot="start">
      <ion-button (click)="dismiss()">Dismiss</ion-button>
    </ion-buttons>
    <ion-button slot="end" color="primary" (click)="onSubmit()"
      >Submit</ion-button
    >
  </ion-toolbar>
</ion-footer>
