<app-header title="Dashboard"></app-header>

<ion-content id="print-section">
  <!-- Accounts Section -->
  <ion-card class="ion-no-margin" color="fav" style="border-radius: 0">
    <ion-card-content>
      <h1 class="title-card">List of accounts</h1>

      <!-- Loading Placeholder -->
      <ng-container *ngIf="loadings; else accountContent">
        <ion-row class="center-row">
          <ion-col *ngFor="let i of [1]" size="6" sizeMd="2">
            <ion-card class="account-card ion-no-margin">
              <ion-card-content class="text-center">
                <ion-skeleton-text animated style="width: 60%; height: 20px; margin: 10px auto"></ion-skeleton-text>
                <ion-skeleton-text animated style="width: 40%; height: 14px; margin: 0 auto"></ion-skeleton-text>
              </ion-card-content>
            </ion-card>
          </ion-col>
        </ion-row>
      </ng-container>

      <!-- Loaded Accounts Content -->
      <ng-template #accountContent>
        <ion-row class="center-row">
          <ng-container *ngIf="account_list.length > 0; else noAccounts">
            <ion-col *ngFor="let item of account_list" size="6" sizeMd="2">
              <ion-card class="account-card ion-no-margin">
                <ion-card-content class="text-center acc-card-content">
                  <ion-icon [name]="item.icon" class="account-icon"></ion-icon>
                  <h2 class="account-title">{{ item.account_name | titlecase }}</h2>
                  <p class="account-balance">{{ item.balance | currency: 'MYR ' }}</p>
                </ion-card-content>
              </ion-card>
            </ion-col>
          </ng-container>

          <ng-template #noAccounts>
            <ion-col size="12" class="text-muted text-center">
              You don't have any account. Let's create a new one.
            </ion-col>
          </ng-template>
        </ion-row>
      </ng-template>

      <!-- Add Account Button -->
      <ion-row class="center-row">
        <ion-col size="6" sizeMd="2">
          <ion-card class="ion-no-margin btn-add-acc" (click)="modalAddAccount()">
            <ion-card-content class="text-center">
              <div class="add-account-content">
                <b>Add Account</b>
                <ion-icon name="add-circle-outline" class="add-icon"></ion-icon>
              </div>
            </ion-card-content>
          </ion-card>
        </ion-col>
      </ion-row>
    </ion-card-content>
  </ion-card>

  <!-- Expenses Section -->
  <ion-card color="sub-fav" class="m-card">
    <ion-card-content class="ion-padding">
      <h1 class="title-card">Expenses Structure</h1>

      <!-- Loading Placeholder -->
      <ng-container *ngIf="loadings; else expenseContent">
        <ion-row>
          <ion-col *ngFor="let i of [1]" size="12">
            <ion-card class="ion-no-margin">
              <ion-card-content class="record-content">
                <ion-avatar class="record-icon">
                  <ion-skeleton-text animated style="width: 40px; height: 40px"></ion-skeleton-text>
                </ion-avatar>
                <div class="record-info" style="flex: 1">
                  <ion-skeleton-text animated style="width: 50%; height: 16px"></ion-skeleton-text>
                  <ion-skeleton-text animated style="width: 30%; height: 14px; margin-top: 6px"></ion-skeleton-text>
                </div>
                <div class="transaction-amount">
                  <ion-skeleton-text animated style="width: 60px; height: 16px"></ion-skeleton-text>
                  <ion-skeleton-text animated style="width: 40px; height: 12px; margin-top: 6px"></ion-skeleton-text>
                </div>
              </ion-card-content>
            </ion-card>
          </ion-col>
        </ion-row>
      </ng-container>

      <!-- Loaded Expenses Content -->
      <ng-template #expenseContent>
        <ion-row>
          <ng-container *ngIf="transactions.length > 0; else notransactions">
            <ion-col *ngFor="let record of transactions" size="12">
              <ion-card class="ion-no-margin transaction-card">
                <ion-card-content class="record-content">
                  <ion-avatar class="record-icon">
                    <ion-icon [name]="record.icon"></ion-icon>
                  </ion-avatar>
                  <div class="record-info">
                    <h2 class="record-title">{{ record.category }}</h2>
                    <p class="record-acc ion-text-capitalize">{{ record.account_name }}</p>
                  </div>
                  <div class="transaction-amount">
                    <p [ngClass]="{ income: record.type == 'income', expense: record.type == 'expense' }">
                      {{ record.type === 'income' ? '+' : '-' }}{{ record.amount | currency: 'MYR ' }}
                    </p>
                    <p class="record-date">{{ record.date | date: 'MMM d, h:mm a' }}</p>
                  </div>
                </ion-card-content>
              </ion-card>
            </ion-col>
          </ng-container>

          <ng-template #notransactions>
            <ion-col size="12" class="text-muted text-center">
              You don't have any expenses record. Let's create a new one.
            </ion-col>
          </ng-template>
        </ion-row>
      </ng-template>
    </ion-card-content>
  </ion-card>

  <!-- Budget Section -->
  <ion-card color="sub-fav" class="m-card">
    <ion-card-content class="ion-padding">
      <h1 class="title-card">Budget Structure</h1>

      <!-- Loading Placeholder -->
      <ng-container *ngIf="loadings; else loadedContent">
        <ion-card *ngFor="let i of [1]" class="budget-card">
          <ion-item lines="none">
            <ion-icon name="wallet-outline" slot="start" color="primary"></ion-icon>
            <ion-label>
              <h2><ion-skeleton-text animated style="width: 60%"></ion-skeleton-text></h2>
              <p><ion-skeleton-text animated style="width: 40%"></ion-skeleton-text></p>
            </ion-label>
            <ion-note slot="end" color="success">
              <ion-skeleton-text animated style="width: 50px; height: 16px"></ion-skeleton-text>
            </ion-note>
          </ion-item>
        </ion-card>
      </ng-container>

      <!-- Loaded Budget Content -->
      <ng-template #loadedContent>
        <ion-list *ngIf="budgets.length === 0; else budgetList">
          <ion-item lines="none">
            <ion-label class="no-budgets">
              You don't have any budget record. Let's create a new one.
            </ion-label>
          </ion-item>
        </ion-list>

        <ng-template #budgetList>
          <ion-card *ngFor="let budget of budgets" (click)="openBudget(budget)" class="budget-card">
            <ion-item lines="none">
              <ion-icon name="wallet-outline" slot="start" color="primary" size="large"></ion-icon>
              <ion-label>
                <h2 class="budget-title">{{ budget.budget_name | titlecase }}</h2>
                <p class="budget-type">{{ budget.budget_type }} Budget</p>
              </ion-label>
              <ion-note slot="end" color="success" class="budget-amount">
                <b>{{ budget.amount | currency: 'MYR ' }}</b>
              </ion-note>
            </ion-item>
          
            <ion-item lines="none">
              <ion-label>
                <div class="budget-summary">
                  <div class="budget-row">
                    <span>Used:</span>
                    <span>{{ budget.used_amount | currency: 'MYR ' }}</span>
                  </div>
                  <div class="budget-row">
                    <span>Remaining:</span>
                    <span>{{ budget.balance_budget | currency: 'MYR ' }}</span>
                  </div>
                  <ion-progress-bar
                    [value]="budget.used_amount / budget.amount"
                    [color]="getProgressColor(budget)">
                  </ion-progress-bar>
                </div>
              </ion-label>
            </ion-item>
          
            <ion-item lines="none">
              <ion-label>
                <p class="update-date">
                  <ion-icon name="calendar-outline" style="vertical-align: middle;"></ion-icon>
                  <span style="margin-left: 4px;">Updated: {{ budget.updated_at | date:'short' }}</span>
                </p>
              </ion-label>
            </ion-item>
          </ion-card>          
        </ng-template>
      </ng-template>
    </ion-card-content>
  </ion-card>
</ion-content>

<app-fab></app-fab>
